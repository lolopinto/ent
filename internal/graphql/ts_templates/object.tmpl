{{reserveImport "graphql" "GraphQLSchema" "GraphQLObjectType" "GraphQLInputObjectType" "GraphQLID" "GraphQLString" "GraphQLEnumType" "GraphQLNonNull" "GraphQLList" "GraphQLFloat" "GraphQLInt" "GraphQLBoolean" "GraphQLUnionType" "GraphQLInterfaceType" }}
{{reserveTypeImport "graphql" "GraphQLFieldConfig" "GraphQLFieldConfigMap" "GraphQLResolveInfo" "GraphQLInputFieldConfigMap" }}
{{ $cfg := .Config -}}
{{$baseObj := .Data -}}

{{reserveTypeImport $baseObj.Package.PackagePath "ID" "RequestContext" }}
{{reserveImport $baseObj.Package.GraphQLPackagePath "GraphQLTime" "GraphQLNodeInterface" "GraphQLEdgeInterface" "GraphQLConnectionInterface" "nodeIDEncoder" "resolveID" "mustDecodeIDFromGQLID" "encodeGQLID" }}

{{$viewerInfo := $cfg.GetTemplatizedViewer -}}
{{ reserveTypeImportPath $viewerInfo.GetImportPath false -}}
{{$viewerType := $viewerInfo.GetImport -}}

{{/* import types that we may need e.g. UserType, ContactType, etc */}}
{{ range $baseObj.Imports -}} 
  {{if .ImportPath -}}
    {{ if .TypeOnly -}}
      {{reserveTypeImportPath . true}}
    {{ else -}}
      {{reserveImportPath . true}}
    {{ end -}}
  {{end -}}
{{ end -}}

{{ range $baseObj.DefaultImports -}} 
  {{if .ImportPath -}}
    {{ if .TypeOnly -}}
      {{reserveTypeImportPath . true}}
    {{ else -}}
      {{reserveDefaultImport .ImportPath .Import}}
    {{ end -}}
  {{end -}}
{{ end -}}

{{ template "interfaces.tmpl" (dict "Base" $baseObj "Interfaces" $baseObj.TSInterfaces) -}}

{{ range $baseObj.UnconditionalImports }}
  {{ if .TypeOnly -}}
    {{reserveTypeImportPath . true}}
    {{ $ignore := useTypeImport .Import }}
  {{ else -}}
    {{reserveImportPath . true}}
    {{ $ignore := useImport .Import }}
  {{ end -}}
{{ end -}}

{{ range $baseObj.Classes -}}
  {{.Contents}}
{{ end -}}

{{ range $baseObj.Enums -}}
  {{ template "enum.tmpl" . -}}
{{ end -}}

{{$nodeInstance := "obj"}}

{{ range $gqlNode := $baseObj.GQLNodes -}}
  {{if eq $gqlNode.GQLType "GraphQLUnionType" -}}
    {{ if $gqlNode.Exported -}}
    export const {{$gqlNode.Type}} = new {{useImport "GraphQLUnionType"}}({
    {{ else -}}
      const {{$gqlNode.Type}} = new {{useImport "GraphQLUnionType"}}({
    {{ end -}}
      name: "{{$gqlNode.Node}}",
      types: () => [
        {{ range .UnionTypes -}}
          {{ useImportMaybe .}},
        {{ end -}}
      ],
    });

  {{ else -}}
    {{ if $gqlNode.Exported -}}
      export const {{$gqlNode.Type}} = new {{useImport $gqlNode.GQLType}}({
    {{ else -}}
      const {{$gqlNode.Type}} = new {{useImport $gqlNode.GQLType}}({
    {{ end -}}
      name: "{{$gqlNode.Node}}",
      {{ if eq $gqlNode.GQLType "GraphQLInputObjectType" -}}
        fields: (): {{useTypeImport "GraphQLInputFieldConfigMap"}} => ({
      {{ else -}}
        {{ $tsType := $gqlNode.TSType -}}
        {{ if $tsType -}}
          {{ if $baseObj.ForeignImport $tsType -}}
            {{$tsType = useImport $tsType -}}
          {{ end -}}
          fields: (): {{useTypeImport "GraphQLFieldConfigMap"}}<{{$tsType}}, {{useTypeImport "RequestContext"}}<{{useTypeImport $viewerType}}>> => ({
        {{ else -}}
        {{/* for interfaces, we just ignore the type */ -}}
          fields: () => ({
        {{ end -}}
      {{ end -}}
        {{ template "field.tmpl" (dict "Base" $baseObj "Node" $gqlNode "NodeInstance" $nodeInstance "ViewerType" $viewerType) -}}
        }),
      {{if .GQLInterfaces -}}
      interfaces: () => [
        {{range $interface := .GQLInterfaces -}}
          {{useImport $interface}},
        {{end -}}
      ],
      {{end -}}
      {{if .IsTypeOfMethod -}}
        isTypeOf(obj) {
          {{ range $line := .IsTypeOfMethod -}}
            {{$line}}
          {{ end -}}
        },
      {{end -}}
    });
  {{end}}
{{end}}

{{ if $baseObj.FieldConfig}}
  {{ template "field_config.tmpl" (dict "Base" $baseObj "FieldConfig" $baseObj.FieldConfig "Config" $cfg) -}}
{{ end -}}
