{{ reserveImport .Package.InternalImportPath "EdgeType" "NodeType" }}
{{ reserveImport .Package.PackagePath "Ent" "ID" "Data" "Viewer" "EdgeQuerySource" "BaseEdgeQuery"}}

{{$schema := .Schema}}
{{$nodeData := .NodeData -}}

{{with .NodeData -}}

  {{ range .GetImportsForQueryBaseFile $schema }} 
    {{ if .DefaultImport -}}
      {{ reserveDefaultImport .PackagePath .Import}}
    {{ else -}}
      {{ reserveImport .PackagePath .Import}}
    {{end -}}
  {{ end}}

  {{$node := useImport .Node}}
  {{range $edge := .EdgeInfo.Associations}}
    {{$name := printf "%sQuery" $edge.TsEdgeConst -}}
  export class {{$name}} extends {{useImport "BaseEdgeQuery"}}<{{$node}}, {{useImport .NodeInfo.Node}}> {
    constructor(viewer: {{useImport "Viewer"}}, src: {{useImport "EdgeQuerySource"}}<{{$node}}>) {
      super(viewer, src, {{useImport "EdgeType"}}.{{$edge.TsEdgeConst}}, {{useImport .NodeInfo.Node}}.loaderOptions());
    }

    static query(
      viewer: {{useImport "Viewer"}},
      src: {{useImport "EdgeQuerySource"}}<{{$node}}>,
    ): {{$name}} {
      return new {{$name}}(viewer, src);
    }

    {{$fNodeData := $schema.GetNodeDataForNode .NodeInfo.Node}}
    {{ range $fEdge := $fNodeData.EdgeInfo.Associations -}}
      {{$queryName := ""}}
      {{/* local, no import necessary */ -}}
      {{ if eq $edge.NodeInfo.Node $nodeData.NodeInfo.Node }}
        {{$queryName = printf "%sQuery" $fEdge.TsEdgeConst -}}
      {{ else -}}
        {{$queryName = useImport (printf "%sQuery" $fEdge.TsEdgeConst) -}}
      {{ end -}}
      query{{$fEdge.CamelCaseEdgeName}}(): {{$queryName}} {
        return {{$queryName}}.query(this.viewer, this);
      }
    {{ end -}}
  }
  {{end}}
{{end -}}